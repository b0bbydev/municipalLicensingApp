<h2>{{policyName}} - History</h2>
<div class="content">
  <h4>Filtering</h4>
  <form method="GET" id="filterForm">
    <div class="row g-0">
      <div class="col-sm-4">
        <select
          class="form-select-sm"
          id="filterMonth"
          title="Month Filter"
          name="filterMonth"
        >
          <option disabled selected>Month...</option>
          {{#if filterMonth}}
            <option value="{{filterMonth}}" selected>{{filterMonth}}</option>
          {{/if}}
          {{#each monthDropdownValues}}
            <option
              value="{{this.dropdownValue}}"
            >{{this.dropdownValue}}</option>
          {{/each}}
        </select>
        <select
          class="form-select-sm"
          id="filterYear"
          title="Year Filter"
          name="filterYear"
        >
          <option disabled selected>Year...</option>
          {{#if filterYear}}
            <option value="{{filterYear}}" selected>{{filterYear}}</option>
          {{/if}}
          {{#each yearDropdownValues}}
            <option
              value="{{this.dropdownValue}}"
            >{{this.dropdownValue}}</option>
          {{/each}}
        </select>
        <button
          id="filterButton"
          class="btn btn-sm btn-primary"
          type="submit"
        >Search</button>
        <a
          id="filterButton"
          href="/policies/policyHistory/{{policyID}}"
          class="btn btn-sm btn-secondary"
          type="submit"
        >Reset</a>
      </div>
    </div>
  </form>
  <!-- check for error messages in the session -->
  {{#if message}}
    <div class="alert alert-danger">
      {{message}}
    </div>
  {{/if}}
  <section class="row">
    <div class="col-12">
      <h4>Policy History</h4>
      <table class="sortable table table-bordered table-striped table-hover">
        <thead>
          <tr>
            <th>Policy Number</th>
            <th>Policy Name</th>
            <th>COW Date</th>
            <th>Council Resolution</th>
            <th>Date Approved</th>
            <th>Date Amended</th>
            <th>Date Effective</th>
            <th>Category</th>
            <th>Last Review Date</th>
            <th>Scheduled Review Date</th>
            <th>Division</th>
            <th>Authority</th>
            <th>Administrator</th>
            <th>Status</th>
            <th>Notes</th>
            <th>Last Modified</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {{#each policyHistory}}
            <tr>
              <td>{{this.policyNumber}}</td>
              <td class="text-nowrap">{{this.policyName}}</td>
              <td class="text-nowrap">{{this.cowDate}}</td>
              <td>{{this.councilResolution}}</td>
              <td>{{this.dateApproved}}</td>
              <td>{{this.dateAmended}}</td>
              <td class="text-nowrap">{{this.dateEffective}}</td>
              <td>{{this.category}}</td>
              <td class="text-nowrap">{{this.lastReviewDate}}</td>
              <td>{{this.scheduledReviewDate}}</td>
              <td>{{this.division}}</td>
              <td>{{this.authority}}</td>
              <td>{{this.administrator}}</td>
              <td>{{this.status}}</td>
              <td>{{this.notes}}</td>
              <td>{{this.lastModified}}</td>
              <td>{{this.action}}</td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  </section>
  <div class="row">
    <div class="col">
      <a id="procedureHistory" onclick="toggleProcedureHistory();">See procedure
        history...</a>
    </div>
    <div class="col">
      <a
        class="float-end"
        id="guidelineHistory"
        onclick="toggleGuidelineHistory();"
      >See guideline history...</a>
    </div>
  </div>

  <section id="procedureHistorySection" class="row" style="display: none;">
    <div class="col-12">
      <h4>Procedure History</h4>
      {{#group procedureHistory by="year"}}
        <strong>{{{value}}}</strong>
        <table class="sortable table table-bordered table-striped table-hover">
          <thead>
            <tr>
              <th>Procedure Name</th>
              <th>Approval Date</th>
              <th>Last Review Date</th>
              <th>Scheduled Review Date</th>
              <th>Date Amended</th>
              <th>Status</th>
              <th>Notes</th>
              <th>Action</th>
              <th>Last Modified</th>
            </tr>
          </thead>
          <tbody>
            {{#each items}}
              <tr>
                <td>{{this.procedureName}}</td>
                <td>{{this.approvalDate}}</td>
                <td>{{this.lastReviewDate}}</td>
                <td>{{this.scheduledReviewDate}}</td>
                <td>{{this.dateAmended}}</td>
                <td>{{this.status}}</td>
                <td>{{this.notes}}</td>
                <td>{{this.action}}</td>
                <td>{{this.lastModified}}</td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      {{/group}}
    </div>
  </section>

  <section id="guidelineHistorySection" class="row" style="display: none;">
    <div class="col-12">
      <h4>Guideline History</h4>
      {{#group guidelineHistory by="year"}}
        <strong>{{{value}}}</strong>
        <table class="sortable table table-bordered table-striped table-hover">
          <thead>
            <tr>
              <th>Guideline Name</th>
              <th>Approval Date</th>
              <th>Last Review Date</th>
              <th>Scheduled Review Date</th>
              <th>Date Amended</th>
              <th>Status</th>
              <th>Notes</th>
              <th>Action</th>
              <th>Last Modified</th>
            </tr>
          </thead>
          <tbody>
            {{#each items}}
              <tr>
                <td>{{this.guidelineName}}</td>
                <td>{{this.approvalDate}}</td>
                <td>{{this.lastReviewDate}}</td>
                <td>{{this.scheduledReviewDate}}</td>
                <td>{{this.dateAmended}}</td>
                <td>{{this.status}}</td>
                <td>{{this.notes}}</td>
                <td>{{this.action}}</td>
                <td>{{this.lastModified}}</td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      {{/group}}
    </div>
  </section>
</div>